imports:
    - path: common.py
    - path: networks.py
    - path: workers.py
    - path: manager.py
    - path: deployment.py

resources:
    - name: deployment
      type: deployment.py
      properties:
          zone: us-east1-c
          subnetwork: us-east1
          seuronImage: ranlu/seuron:main
          project: segmentation
          managerMachineType: e2-medium
          composeLocation: https://raw.githubusercontent.com/seung-lab/seuron/main/deploy/docker-compose-CeleryExecutor.yml
          slack:
            botToken: # bot token for slack
            notificationChannel: seuron-alerts
          enableJupyterInterface: False
          nginx:
            user: # nginx username
            password: # nginx password, set it to null if you do not want a password
          airflow:
            remoteLogFolder: # GCS path to save airflow logs
            # fernetKey: generated automatically if not given
            # secretKey: generated automatically if not given
            user: # username for airflow services
            password: # password for airflow services
          postgres:
            user: # postgres username
            password: # postgres password
            database: # postgres database for airflow
          grafana:
            user: # grafana username
            password: # grafana password
          workerInstanceGroups:
            - type: gpu
              zone: us-east1-c
              subnetwork: us-east1
              machineType: n1-highmem-4
              gpuWorkerAcceleratorType: nvidia-tesla-t4
              concurrency: 2
              preemptible: True
              sizeLimit: 4
            - type: gpu
              zone: us-central1-c
              subnetwork: us-central1
              machineType: n1-highmem-4
              gpuWorkerAcceleratorType: nvidia-tesla-t4
              concurrency: 2
              preemptible: True
              sizeLimit: 4
            - type: atomic
              zone: us-east1-c
              subnetwork: us-east1
              machineType: e2-standard-32
              preemptible: True
              reserveHugePages: True
              sizeLimit: 100
            - type: composite
              zone: us-east1-c
              subnetwork: us-east1
              machineType: e2-standard-32
              preemptible: False
              reserveHugePages: True
              workerConcurrencies:
                - layer: 5
                  concurrency: 2
                - layer: 6
                  concurrency: 1
              sizeLimit: 1
            - type: igneous
              zone: us-east1-c
              subnetwork: us-east1
              machineType: e2-standard-32
              preemptible: True
              concurrency: 32
              sizeLimit: 50
            - type: custom-cpu
              zone: us-east1-c
              subnetwork: us-east1
              machineType: e2-standard-32
              concurrency: 32
              preemptible: True
              sizeLimit: 50
            - type: custom-gpu
              zone: us-east1-c
              subnetwork: us-east1
              machineType: n1-highmem-8
              gpuWorkerAcceleratorType: nvidia-tesla-t4
              concurrency: 2
              preemptible: True
              sizeLimit: 4
            - type: synaptor-cpu
              zone: us-east1-c
              subnetwork: us-east1
              machineType: e2-highmem-4
              preemptible: True
              sizeLimit: 10
            - type: synaptor-gpu
              zone: us-east1-c
              subnetwork: us-east1
              machineType: n1-highmem-8
              gpuWorkerAcceleratorType: nvidia-tesla-t4
              preemptible: True
              sizeLimit: 10
            - type: synaptor-seggraph
              zone: us-east1-c
              subnetwork: us-east1
              machineType: n2d-highmem-32
              preemptible: False
              sizeLimit: 1
          firewallAllowedIPRanges:
              - 128.112.0.0/16
